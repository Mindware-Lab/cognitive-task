<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wellbeing & Attention Task</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 800px;
            width: 100%;
            padding: 40px;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }

        h2 {
            color: #555;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .intro-text {
            line-height: 1.6;
            color: #666;
            margin-bottom: 30px;
        }

        .question {
            margin-bottom: 30px;
        }

        .question-text {
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .likert-option {
            flex: 1;
            text-align: center;
        }

        .likert-option input[type="radio"] {
            display: none;
        }

        .likert-option label {
            display: block;
            padding: 15px 10px;
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            color: #666;
        }

        .likert-option input[type="radio"]:checked + label {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .likert-option label:hover {
            border-color: #667eea;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #999;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin-top: 20px;
        }

        button:hover {
            background: #5568d3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .task-screen {
            position: relative;
            min-height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .fixation {
            font-size: 48px;
            font-weight: bold;
            color: #333;
        }

        .word-pair {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
        }

        .word {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            padding: 20px;
        }

        .probe {
            font-size: 48px;
            font-weight: bold;
            color: #667eea;
        }

        .trial-counter {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 14px;
            color: #999;
        }

        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            line-height: 1.6;
            color: #555;
        }

        .key-reminder {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
        }

        .key {
            text-align: center;
        }

        .key-button {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .results {
            line-height: 1.8;
            color: #555;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }

        .result-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .result-label {
            font-size: 14px;
            color: #999;
            margin-bottom: 5px;
        }

        .result-value {
            font-size: 28px;
            font-weight: bold;
            color: #333;
        }

        .recommendation {
            background: #667eea;
            color: white;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            margin-top: 30px;
        }

        .recommendation h3 {
            margin-bottom: 10px;
            font-size: 24px;
        }

        .recommendation p {
            font-size: 18px;
            opacity: 0.9;
        }

        .hidden {
            visibility: hidden;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen -->
        <div class="screen active" id="welcome-screen">
            <h1>Wellbeing & Attention Assessment</h1>
            <div class="intro-text">
                <p>Welcome! This assessment consists of two parts:</p>
                <ul style="margin: 15px 0 15px 20px; line-height: 1.8;">
                    <li><strong>Part 1:</strong> A brief wellbeing questionnaire (3 questions)</li>
                    <li><strong>Part 2:</strong> An attention task (24 trials, ~3 minutes)</li>
                </ul>
                <p>Your responses will help determine a personalized recommendation for your daily intensity level.</p>
                <p style="margin-top: 15px;"><strong>Time required:</strong> Approximately 5 minutes</p>
            </div>
            <button onclick="startQuestionnaire()">Begin Assessment</button>
        </div>

        <!-- Questionnaire Screen -->
        <div class="screen" id="questionnaire-screen">
            <h1>Wellbeing Questionnaire</h1>
            <h2>Please rate how you feel right now</h2>

            <div class="question">
                <div class="question-text">1. How energetic do you feel?</div>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="q1" id="q1-1" value="1">
                        <label for="q1-1">1</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q1" id="q1-2" value="2">
                        <label for="q1-2">2</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q1" id="q1-3" value="3">
                        <label for="q1-3">3</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q1" id="q1-4" value="4">
                        <label for="q1-4">4</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q1" id="q1-5" value="5">
                        <label for="q1-5">5</label>
                    </div>
                </div>
                <div class="scale-labels">
                    <span>Not at all</span>
                    <span>Extremely</span>
                </div>
            </div>

            <div class="question">
                <div class="question-text">2. How positive is your mood?</div>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="q2" id="q2-1" value="1">
                        <label for="q2-1">1</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q2" id="q2-2" value="2">
                        <label for="q2-2">2</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q2" id="q2-3" value="3">
                        <label for="q2-3">3</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q2" id="q2-4" value="4">
                        <label for="q2-4">4</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q2" id="q2-5" value="5">
                        <label for="q2-5">5</label>
                    </div>
                </div>
                <div class="scale-labels">
                    <span>Very negative</span>
                    <span>Very positive</span>
                </div>
            </div>

            <div class="question">
                <div class="question-text">3. How focused do you feel?</div>
                <div class="likert-scale">
                    <div class="likert-option">
                        <input type="radio" name="q3" id="q3-1" value="1">
                        <label for="q3-1">1</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q3" id="q3-2" value="2">
                        <label for="q3-2">2</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q3" id="q3-3" value="3">
                        <label for="q3-3">3</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q3" id="q3-4" value="4">
                        <label for="q3-4">4</label>
                    </div>
                    <div class="likert-option">
                        <input type="radio" name="q3" id="q3-5" value="5">
                        <label for="q3-5">5</label>
                    </div>
                </div>
                <div class="scale-labels">
                    <span>Not at all</span>
                    <span>Extremely</span>
                </div>
            </div>

            <button id="submit-questionnaire" onclick="submitQuestionnaire()" disabled>Continue to Task</button>
        </div>

        <!-- Task Instructions Screen -->
        <div class="screen" id="instructions-screen">
            <h1>Attention Task</h1>
            <div class="instructions">
                <p><strong>Instructions:</strong></p>
                <ol style="margin: 15px 0 15px 20px; line-height: 1.8;">
                    <li>You will see a <strong>+</strong> symbol in the center</li>
                    <li>Then two words will appear briefly on the left and right</li>
                    <li>After the words disappear, a <strong>dot (•)</strong> will appear on one side</li>
                    <li>Press <strong>F</strong> if the dot is on the <strong>left</strong></li>
                    <li>Press <strong>J</strong> if the dot is on the <strong>right</strong></li>
                    <li>Respond as quickly and accurately as possible</li>
                </ol>
                <p style="margin-top: 15px;">There will be 24 trials. Take a moment to rest your fingers on the F and J keys.</p>
            </div>

            <div class="key-reminder">
                <div class="key">
                    <div class="key-button">F</div>
                    <div>Left</div>
                </div>
                <div class="key">
                    <div class="key-button">J</div>
                    <div>Right</div>
                </div>
            </div>

            <button onclick="startTask()">Start Task</button>
        </div>

        <!-- Task Screen -->
        <div class="screen" id="task-screen">
            <div class="task-screen">
                <div class="trial-counter" id="trial-counter"></div>
                <div id="task-content"></div>
            </div>
        </div>

        <!-- Results Screen -->
        <div class="screen" id="results-screen">
            <h1>Assessment Complete</h1>
            
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-label">Wellbeing Score</div>
                    <div class="result-value" id="wellbeing-score"></div>
                </div>
                <div class="result-card">
                    <div class="result-label">Task Accuracy</div>
                    <div class="result-value" id="accuracy"></div>
                </div>
                <div class="result-card">
                    <div class="result-label">Avg Reaction Time</div>
                    <div class="result-value" id="avg-rt"></div>
                </div>
                <div class="result-card">
                    <div class="result-label">Attention Bias</div>
                    <div class="result-value" id="bias-score"></div>
                </div>
            </div>

            <div class="recommendation" id="recommendation">
                <h3 id="rec-title"></h3>
                <p id="rec-text"></p>
            </div>

            <button onclick="location.reload()">Take Assessment Again</button>
        </div>
    </div>

    <script>
        // App state
        const state = {
            wellbeingScore: 0,
            currentTrial: 0,
            trials: [],
            results: []
        };

        // Word pairs for dot-probe task
        const negativeWords = [
            'FAILURE', 'THREAT', 'DANGER', 'REJECT', 'HATE', 'FEAR',
            'PAIN', 'DEATH', 'SICK', 'EVIL', 'WRONG', 'ANGRY'
        ];

        const neutralWords = [
            'CURTAIN', 'PENCIL', 'BUTTON', 'PAPER', 'TABLE', 'CARPET',
            'CLOCK', 'PLANT', 'CHAIR', 'TOWEL', 'BOTTLE', 'FOLDER'
        ];

        // Enable questionnaire submit button when all questions answered
        document.querySelectorAll('input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', checkQuestionnaireComplete);
        });

        function checkQuestionnaireComplete() {
            const q1 = document.querySelector('input[name="q1"]:checked');
            const q2 = document.querySelector('input[name="q2"]:checked');
            const q3 = document.querySelector('input[name="q3"]:checked');
            
            document.getElementById('submit-questionnaire').disabled = !(q1 && q2 && q3);
        }

        function startQuestionnaire() {
            showScreen('questionnaire-screen');
        }

        function submitQuestionnaire() {
            const q1 = parseInt(document.querySelector('input[name="q1"]:checked').value);
            const q2 = parseInt(document.querySelector('input[name="q2"]:checked').value);
            const q3 = parseInt(document.querySelector('input[name="q3"]:checked').value);
            
            state.wellbeingScore = q1 + q2 + q3;
            showScreen('instructions-screen');
        }

        function startTask() {
            generateTrials();
            showScreen('task-screen');
            runTrial();
        }

        function generateTrials() {
            // Create 24 trials: 12 congruent, 12 incongruent
            const trials = [];
            
            for (let i = 0; i < 12; i++) {
                // Congruent trial (probe replaces negative word)
                const negWord = negativeWords[i % negativeWords.length];
                const neuWord = neutralWords[i % neutralWords.length];
                const negOnLeft = Math.random() < 0.5;
                
                trials.push({
                    negativeWord: negWord,
                    neutralWord: neuWord,
                    negativeOnLeft: negOnLeft,
                    probeOnLeft: negOnLeft, // probe replaces negative = congruent
                    congruent: true
                });
                
                // Incongruent trial (probe replaces neutral word)
                const negWord2 = negativeWords[(i + 6) % negativeWords.length];
                const neuWord2 = neutralWords[(i + 6) % neutralWords.length];
                const negOnLeft2 = Math.random() < 0.5;
                
                trials.push({
                    negativeWord: negWord2,
                    neutralWord: neuWord2,
                    negativeOnLeft: negOnLeft2,
                    probeOnLeft: !negOnLeft2, // probe replaces neutral = incongruent
                    congruent: false
                });
            }
            
            // Shuffle trials
            state.trials = trials.sort(() => Math.random() - 0.5);
            state.currentTrial = 0;
            state.results = [];
        }

        async function runTrial() {
            if (state.currentTrial >= state.trials.length) {
                showResults();
                return;
            }

            const trial = state.trials[state.currentTrial];
            const content = document.getElementById('task-content');
            const counter = document.getElementById('trial-counter');
            
            counter.textContent = `Trial ${state.currentTrial + 1} / ${state.trials.length}`;

            // Fixation cross (500ms)
            content.innerHTML = '<div class="fixation">+</div>';
            await sleep(500);

            // Word pair (500ms)
            const leftWord = trial.negativeOnLeft ? trial.negativeWord : trial.neutralWord;
            const rightWord = trial.negativeOnLeft ? trial.neutralWord : trial.negativeWord;
            
            content.innerHTML = `
                <div class="word-pair">
                    <div class="word">${leftWord}</div>
                    <div class="word">${rightWord}</div>
                </div>
            `;
            await sleep(500);

            // Probe
            const probePosition = trial.probeOnLeft ? 'left' : 'right';
            content.innerHTML = `
                <div class="word-pair">
                    <div class="probe" style="visibility: ${trial.probeOnLeft ? 'visible' : 'hidden'}">•</div>
                    <div class="probe" style="visibility: ${trial.probeOnLeft ? 'hidden' : 'visible'}">•</div>
                </div>
            `;

            // Wait for response
            const startTime = Date.now();
            const response = await waitForKeypress(['f', 'j']);
            const reactionTime = Date.now() - startTime;
            
            const correct = (response === 'f' && trial.probeOnLeft) || 
                          (response === 'j' && !trial.probeOnLeft);

            state.results.push({
                ...trial,
                reactionTime,
                correct,
                response
            });

            // Brief pause before next trial
            content.innerHTML = '';
            await sleep(200);

            state.currentTrial++;
            runTrial();
        }

        function waitForKeypress(validKeys) {
            return new Promise(resolve => {
                function handler(e) {
                    const key = e.key.toLowerCase();
                    if (validKeys.includes(key)) {
                        document.removeEventListener('keydown', handler);
                        resolve(key);
                    }
                }
                document.addEventListener('keydown', handler);
            });
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function showResults() {
            // Calculate metrics
            const correctTrials = state.results.filter(r => r.correct);
            const accuracy = (correctTrials.length / state.results.length * 100).toFixed(1);
            
            const avgRT = (correctTrials.reduce((sum, r) => sum + r.reactionTime, 0) / correctTrials.length).toFixed(0);
            
            // Calculate bias score: mean RT(incongruent) - mean RT(congruent)
            const congruentTrials = correctTrials.filter(r => r.congruent);
            const incongruentTrials = correctTrials.filter(r => !r.congruent);
            
            const congruentRT = congruentTrials.reduce((sum, r) => sum + r.reactionTime, 0) / congruentTrials.length;
            const incongruentRT = incongruentTrials.reduce((sum, r) => sum + r.reactionTime, 0) / incongruentTrials.length;
            
            const biasScore = (incongruentRT - congruentRT).toFixed(0);

            // Display results
            document.getElementById('wellbeing-score').textContent = `${state.wellbeingScore}/15`;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('avg-rt').textContent = `${avgRT}ms`;
            document.getElementById('bias-score').textContent = `${biasScore}ms`;

            // Generate recommendation
            const lowWellbeing = state.wellbeingScore <= 9; // Low = 9 or less out of 15
            const strongPositiveBias = parseFloat(biasScore) > 50; // Strong positive = >50ms
            const highWellbeing = state.wellbeingScore >= 12; // High = 12 or more out of 15
            const notPositiveBias = parseFloat(biasScore) <= 0; // Not positive = 0 or negative

            let title, text;

            if (lowWellbeing || strongPositiveBias) {
                title = "Take it easy today";
                text = "Your results suggest prioritizing rest and self-care activities.";
            } else if (highWellbeing && notPositiveBias) {
                title = "Work at intensity today";
                text = "You're in an optimal state for challenging tasks and high performance.";
            } else {
                title = "Moderate intensity";
                text = "Balance productivity with adequate breaks and self-care.";
            }

            document.getElementById('rec-title').textContent = title;
            document.getElementById('rec-text').textContent = text;

            showScreen('results-screen');
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
    </script>
</body>
</html>
